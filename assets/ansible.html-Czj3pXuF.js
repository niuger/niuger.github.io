import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as l,c as i,b as s,e as n,d as e,a as t}from"./app-D1uezr0R.js";const c="/assets/true-image-20220728130527266-Dvf7KOWw.png",u={},r=s("p",null,"Ansible AD-Hoc命令执行工具",-1),d=s("h1",{id:"ansible-ad-hoc命令执行工具",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ansible-ad-hoc命令执行工具"},[s("span",null,"Ansible AD-Hoc命令执行工具")])],-1),k={href:"http://ansible.com.cn/docs/intro.html",target:"_blank",rel:"noopener noreferrer"},m={href:"https://pan.baidu.com/s/1fkosURl4HaYZALtSjKvcKg",target:"_blank",rel:"noopener noreferrer"},b=t(`<h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><p>Ansibe AD-Hoc 临时命令执行工具，常用于临时命令的执行</p><div class="language-css line-numbers-mode" data-ext="css" data-title="css"><pre class="language-css"><code>ansible &lt;host-pattern&gt; [-f forks] [-m module_name] [-a args]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>也可以通过<code>ansible -h</code>来查看帮助，下面我们列出一些比较常用的选项，并解释其含义：</p><ul><li><strong>-a MODULE_ARGS</strong>：模块的参数，如果执行默认COMMAND的模块，即是命令参数，如： “date”，“pwd”等等</li><li><strong>-k,--ask-pass</strong>：ask for SSH password。登录密码，提示输入SSH密码而不是假设基于密钥的验证</li><li><strong>--ask-su-pass</strong>：ask for su password。su切换密码</li><li><strong>-K,--ask-sudo-pass</strong>：ask for sudo password。提示密码使用sudo，sudo表示提权操作</li><li><strong>--ask-vault-pass</strong>：ask for vault password。假设我们设定了加密的密码，则用该选项进行访问</li><li><strong>-B SECONDS</strong>：后台运行超时时间</li><li><strong>-C</strong>：模拟运行环境并进行预运行，可以进行查错测试</li><li><strong>-c CONNECTION</strong>：连接类型使用</li><li><strong>-f FORKS</strong>：并行任务数，默认为5</li><li><strong>-i INVENTORY</strong>：指定主机清单的路径，默认为<code>/etc/ansible/hosts</code></li><li><strong>--list-hosts</strong>：查看有哪些主机组</li><li><strong>-m MODULE_NAME</strong>：执行模块的名字，默认使用 command 模块，所以如果是只执行单一命令可以不用 -m参数</li><li><strong>-o</strong>：压缩输出，尝试将所有结果在一行输出，一般针对收集工具使用</li><li><strong>-S</strong>：用 su 命令</li><li><strong>-R SU_USER</strong>：指定 su 的用户，默认为 root 用户</li><li><strong>-s</strong>：用 sudo 命令</li><li><strong>-U SUDO_USER</strong>：指定 sudo 到哪个用户，默认为 root 用户</li><li><strong>-T TIMEOUT</strong>：指定 ssh 默认超时时间，默认为10s，也可在配置文件中修改</li><li><strong>-u REMOTE_USER</strong>：远程用户，默认为 root 用户</li></ul><h2 id="自己配置" tabindex="-1"><a class="header-anchor" href="#自己配置"><span>自己配置</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 自定义主机与组
[web]
192.168.0.[8:10]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主机连通性测试：ansible web -m ping</p><p>会出现ping不通</p><figure><img src="`+c+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="ssh免密登录" tabindex="-1"><a class="header-anchor" href="#ssh免密登录"><span>SSH免密登录</span></a></h2>',11),v={href:"https://blog.csdn.net/qq_42476834/article/details/124766896",target:"_blank",rel:"noopener noreferrer"},g=t(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#1.生成私钥(主-被控制端最好都要生成)</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen -t rsa</span>
<span class="token comment">#2.向主机分发私钥</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@192.168.0.8 ssh-copy-id a@192.168.0.8</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@192.168.0.9 ssh-copy-id a@192.168.0.9</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@192.168.0.10 ssh-copy-id a@192.168.0.10</span>

校验：
<span class="token function">ssh</span> root@192.168.0.8   <span class="token function">ssh</span> a@192.168.0.8
<span class="token function">ssh</span> root@192.168.0.9   <span class="token function">ssh</span> a@192.168.0.9
<span class="token function">ssh</span> root@192.168.0.10   <span class="token function">ssh</span> a@192.168.0.10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看192.168.0.8用户ssh目录 authorized_keys</p><blockquote><p>ssh-rsa xxx/ph8H3i2mKHscP root@admin</p></blockquote><p>或者是在清单中设置ssh登录</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>web<span class="token punctuation">]</span>
<span class="token number">192.168</span>.0.8 <span class="token assign-left variable">ansible_port</span><span class="token operator">=</span><span class="token number">22</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="主机连通性测试" tabindex="-1"><a class="header-anchor" href="#主机连通性测试"><span>主机连通性测试</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># ansible web -m ping</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.0.10 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.0.9 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="command-模块-直接在远程主机上执行命令-并将结果返回本主机" tabindex="-1"><a class="header-anchor" href="#command-模块-直接在远程主机上执行命令-并将结果返回本主机"><span>command 模块（直接在远程主机上执行命令，并将结果返回本主机）</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;ss -ntl&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>    <span class="token number">127.0</span>.0.1:25                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:111                      *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:22                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>      <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:25                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:111                   <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
<span class="token number">192.168</span>.0.10 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>    <span class="token number">127.0</span>.0.1:25                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:111                      *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:22                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>      <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:25                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:111                   <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
<span class="token number">192.168</span>.0.9 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:22                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>    <span class="token number">127.0</span>.0.1:25                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:111                      *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>      <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:25                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:111                   <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>命令模块接受命令名称，后面是空格分隔的列表参数。给定的命令将在所有选定的节点上执行。它不会通过shell进行处理，比如 $HOME 和操作如 &quot;&lt;&quot;，&quot;&gt;&quot;，&quot;|&quot;，&quot;;&quot;，&quot;&amp;&quot; 工作（需要使用（shell）模块实现这些功能）。</p><p><strong>注意</strong>：该命令不支持<code>| 管道命令</code>。</p><p>该模块下常用的几个命令：</p><ul><li><strong>chdir</strong>：在执行命令之前，先切换到该目录</li><li><strong>executable</strong>：切换shell来执行命令，需要使用命令的绝对路径</li><li><strong>free_form</strong>：要执行的Linux指令，一般使用Ansible的-a参数代替。</li><li><strong>creates</strong>：一个文件名，当这个文件存在，则该命令不执行,可以用来做判断</li><li><strong>removes</strong>：一个文件名，这个文件不存在，则该命令不执行</li></ul><h3 id="chdir在执行命令之前-先切换到该目录" tabindex="-1"><a class="header-anchor" href="#chdir在执行命令之前-先切换到该目录"><span>chdir在执行命令之前，先切换到该目录</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;chdir=/root/ ls -all&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
总用量 <span class="token number">28</span>
dr-xr-x---.  <span class="token number">7</span> root root  <span class="token number">204</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">13</span>:19 <span class="token builtin class-name">.</span>
dr-xr-xr-x. <span class="token number">17</span> root root  <span class="token number">224</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">11</span>:04 <span class="token punctuation">..</span>
-rw-------.  <span class="token number">1</span> root root <span class="token number">1614</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">11</span>:05 anaconda-ks.cfg
drwx------.  <span class="token number">3</span> root root   <span class="token number">17</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">13</span>:19 .ansible
-rw-------.  <span class="token number">1</span> root root  <span class="token number">540</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">13</span>:29 .bash_history
-rw-r--r--.  <span class="token number">1</span> root root   <span class="token number">18</span> <span class="token number">12</span>月 <span class="token number">29</span> <span class="token number">2013</span> .bash_logout
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> <span class="token number">12</span>月 <span class="token number">29</span> <span class="token number">2013</span> .bash_profile
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> <span class="token number">12</span>月 <span class="token number">29</span> <span class="token number">2013</span> .bashrc
drwxr-xr-x.  <span class="token number">3</span> root root   <span class="token number">18</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">11</span>:06 .cache
drwxr-xr-x.  <span class="token number">3</span> root root   <span class="token number">18</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">11</span>:06 .config
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">100</span> <span class="token number">12</span>月 <span class="token number">29</span> <span class="token number">2013</span> .cshrc
drwxr-----.  <span class="token number">3</span> root root   <span class="token number">19</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">11</span>:18 .pki
drwx------.  <span class="token number">2</span> root root   <span class="token number">61</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">13</span>:12 .ssh
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">129</span> <span class="token number">12</span>月 <span class="token number">29</span> <span class="token number">2013</span> .tcshrc
<span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="creates-存在-不执行ls-不存在-执行ls" tabindex="-1"><a class="header-anchor" href="#creates-存在-不执行ls-不存在-执行ls"><span>creates（存在，不执行ls，不存在，执行ls）</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 存在，不执行ls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;creates=/root/test.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
skipped, since /root/test.png exists

<span class="token comment"># 不存在，执行ls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;creates=/root/test1.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
anaconda-ks.cfg
test.png
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="removes-存在-执行ls、不存在-不执行ls" tabindex="-1"><a class="header-anchor" href="#removes-存在-执行ls、不存在-不执行ls"><span>removes（存在，执行ls、不存在，不执行ls）</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 存在，执行ls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;removes=/root/test.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
anaconda-ks.cfg
test.png

<span class="token comment"># 不存在，不执行ls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;removes=/root/test1.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
skipped, since /root/test1.png does not exist
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="shell-模块" tabindex="-1"><a class="header-anchor" href="#shell-模块"><span>Shell 模块</span></a></h2><p>shell模块可以在远程主机上调用shell解释器运行命令，支持shell的各种功能，例如管道等。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/passwd |grep &quot;root&quot;&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
root:x:0:0:root:/root:/bin/bash
operator:x:11:0:operator:/root:/sbin/nologin
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="copy-模块" tabindex="-1"><a class="header-anchor" href="#copy-模块"><span>copy 模块</span></a></h2><p>将文件复制到远程主机，同时支持给定内容生成文件和修改权限等。</p><p>相关选项如下：</p><ul><li><strong>src</strong>：本地文件。可以是绝对路径，也可以是相对路径。如果路径是一个目录，则会递归复制，用法类似于&quot;rsync&quot;</li><li><strong>content</strong>：用于替换&quot;src&quot;，可以直接指定文件的值</li><li><strong>dest</strong>：<em>必选项</em>，将源文件复制到的远程主机的<strong>绝对路径</strong></li><li><strong>backup</strong>：当文件内容发生改变后，在覆盖之前把源文件备份，备份文件包含时间信息</li><li><strong>directory_mode</strong>：递归设定目录的权限，默认为系统默认权限</li><li><strong>force</strong>：当目标主机包含该文件，但内容不同时，设为&quot;yes&quot;，表示强制覆盖；设为&quot;no&quot;，表示目标主机的目标位置不存在该文件才复制。默认为&quot;yes&quot;</li><li><strong>others</strong>：所有的 file 模块中的选项可以在这里使用</li></ul><h3 id="复制文件-src、dest" tabindex="-1"><a class="header-anchor" href="#复制文件-src、dest"><span>复制文件（src、dest）</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ll</span>
总用量 <span class="token number">8</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">2174</span> <span class="token number">5</span>月  <span class="token number">10</span> <span class="token number">14</span>:10 anaconda-ks.cfg
<span class="token parameter variable">-rwxrwxrwx</span>  <span class="token number">1</span> root root <span class="token number">1960</span> <span class="token number">5</span>月  <span class="token number">10</span> <span class="token number">19</span>:32 first.sh

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m copy -a &#39;src=./first.sh dest=/root/first.sh&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;23f3ef0aebb2a24b97c6617c3fe8a190dc1befed&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/first.sh&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;749f84620ba675946859e0d5a8c68ec5&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1960</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1658988228.09-12252-115055636503998/source&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

远程查看：
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -all /root/first.sh&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1960</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:03 /root/first.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="给定内容生成文件-content-并制定权限-mode" tabindex="-1"><a class="header-anchor" href="#给定内容生成文件-content-并制定权限-mode"><span>给定内容生成文件（content），并制定权限（mode）</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ansible web <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">&#39;src=/root/ds.txt dest=/root/ds.txt mode=777&#39;</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m copy -a &#39;content=&quot;I am admin666 to copy test\\n&quot; dest=/root/ds.txt mode=777&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;f1027296960724e4f07c7f6d695e2a9d59a41fc6&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/ds.txt&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ebe73ae34d327b8966e3a20fafd80eda&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">27</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1658988702.62-14114-156810509219572/source&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看文件</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -all /root/ds.txt&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rwxrwxrwx. <span class="token number">1</span> root root <span class="token number">27</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:11 /root/ds.txt

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /root/ds.txt&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
I am admin666 to copy <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="覆盖备份-backup" tabindex="-1"><a class="header-anchor" href="#覆盖备份-backup"><span>覆盖备份（backup）</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m copy -a &#39;content=&quot;I am admin666 to backup test\\n&quot; backup=yes dest=/root/ds.txt mode=777&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;f1027296960724e4f07c7f6d695e2a9d59a41fc6&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/ds.txt&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/ds.txt&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">27</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看文件</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls /root/&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
anaconda-ks.cfg
ds.txt
ds.txt.13370.2022-07-28@14:20:20~
first.sh
test.png

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /root/ds.txt&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
I am admin666 to backup <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="file-模块-文件管理" tabindex="-1"><a class="header-anchor" href="#file-模块-文件管理"><span>file 模块（文件管理）</span></a></h2><p>主要用于设置文件的属性，比如创建文件、创建链接文件、删除文件等。</p><p>常见的命令：</p><ul><li><strong>force</strong>：需要在两种情况下强制创建软链接，一种是源文件不存在，但之后会建立的情况下；另一种是目标软链接已存在，需要先取消之前的软链，然后创建新的软链，有两个选项：<code>yes|no</code></li><li><strong>group</strong>：定义文件/目录的属组。</li><li><strong>mode</strong>：定义文件/目录的权限</li><li><strong>owner</strong>：定义文件/目录的属主。</li><li><strong>path</strong>：<em>(必选项)</em>，定义文件/目录的路径</li><li><strong>recurse</strong>：递归设置文件的属性，只对目录有效，后面跟上<code>src</code>：被链接的源文件路径，只应用于<code>state=link</code>的情况</li><li><strong>dest</strong>：被链接到的路径，只应用于<code>state=link</code>的情况</li><li><strong>state</strong>：状态，有以下选项：</li><li><ul><li><em>directory</em>：如果目录不存在，就创建目录</li></ul></li><li><ul><li><em>file</em>：即使文件不存在，也不会被创建</li></ul></li><li><ul><li><em>link</em>：创建软链接</li></ul></li><li><ul><li><em>hard</em>：创建硬链接</li></ul></li><li><ul><li><em>touch</em>：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间</li></ul></li><li><ul><li><em>absent</em>：删除目录、文件或者取消链接文件</li></ul></li></ul><h3 id="创建目录" tabindex="-1"><a class="header-anchor" href="#创建目录"><span>创建目录</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/app state=directory&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0755&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/app&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /root&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
总用量 <span class="token number">16</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">1614</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">11</span>:05 anaconda-ks.cfg
drwxr-xr-x. <span class="token number">2</span> root root    <span class="token number">6</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:28 app
-rwxrwxrwx. <span class="token number">1</span> root root   <span class="token number">29</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:20 ds.txt
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">26</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:19 ds.txt.13370.2022-07-28@14:20:20~
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1960</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:03 first.sh
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">0</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">13</span>:44 test.png
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建链接文件" tabindex="-1"><a class="header-anchor" href="#创建链接文件"><span>创建链接文件</span></a></h3><p>为test.jpg创建链接</p><ul><li>link：创建软链接</li><li>hard：创建硬链接</li></ul><p>force：需要在两种情况下强制创建软链接，一种是源文件不存在，但之后会建立的情况下；另一种是目标软链接已存在，需要先取消之前的软链，然后创建新的软链，有两个选项：<code>yes|no</code></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/test2.png src=/root/test.png state=link&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test2.png&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">14</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test.png&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;link&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/test3.png src=/root/test.png state=hard&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test3.png&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test.png&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;hard&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /root/&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
lrwxrwxrwx. <span class="token number">1</span> root root   <span class="token number">14</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:39 test2.png -<span class="token operator">&gt;</span> /root/test.png
-rw-r--r--. <span class="token number">2</span> root root    <span class="token number">0</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">13</span>:44 test3.png
-rw-r--r--. <span class="token number">2</span> root root    <span class="token number">0</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">13</span>:44 test.png
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除文件" tabindex="-1"><a class="header-anchor" href="#删除文件"><span>删除文件</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/test3.png state=absent&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test3.png&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;absent&quot;</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /root/test3.png&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">2</span> <span class="token operator">&gt;&gt;</span>
ls: 无法访问/root/test3.png: 没有那个文件或目录non-zero <span class="token builtin class-name">return</span> code
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fetch-模块-复制远程文件到本地主机" tabindex="-1"><a class="header-anchor" href="#fetch-模块-复制远程文件到本地主机"><span>fetch 模块（复制远程文件到本地主机）</span></a></h2><p>用于从远程某主机获取（复制）文件到本地。</p><ul><li><strong>dest</strong>：用来存放文件的目录</li><li><strong>src</strong>：在远程拉取的文件，并且必须是一个<strong>file</strong>，不能是<strong>目录</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m fetch -a &#39;src=/root/ds.txt dest=/root&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dbd48461fe5fff10ea97f688511ba74a292ab6f9&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/192.168.0.8/root/ds.txt&quot;</span>,
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;9a282b66af8d46bceabdcd71173fc67d&quot;</span>,
    <span class="token string">&quot;remote_checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dbd48461fe5fff10ea97f688511ba74a292ab6f9&quot;</span>,
    <span class="token string">&quot;remote_md5sum&quot;</span><span class="token builtin class-name">:</span> null
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ls -l /root/192.168.0.8/root/ds.txt</span>
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">29</span> <span class="token number">7</span>月  <span class="token number">28</span> <span class="token number">14</span>:46 /root/192.168.0.8/root/ds.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以在本机上查看一下文件是否复制成功。要注意，文件保存的路径是我们设置的接收目录下的<code>被管制主机ip</code>目录下</p><h2 id="cron-模块-计划任务" tabindex="-1"><a class="header-anchor" href="#cron-模块-计划任务"><span>cron 模块（计划任务）</span></a></h2><p>用于管理<code>cron</code>计划任务的。</p><p>其使用的语法跟我们的<code>crontab</code>文件中的语法一致，同时，可以指定以下选项：</p><ul><li><strong>month</strong>：月( 1-12, *, */2)</li><li><strong>weekday</strong>：周 ( 0-6 for Sunday-Saturday)</li><li><strong>day</strong>：天( 1-31, *, */2)</li><li><strong>hour</strong>：小时 ( 0-23, *, */2)</li><li><strong>minute</strong>：分钟( 0-59, *, */2)</li><li><strong>job</strong>：指明运行的命令是什么</li><li><strong>name</strong>：定时任务描述</li><li><strong>reboot</strong>：任务在重启时运行，不建议使用，建议使用special_time</li><li><strong>special_time</strong>：特殊的时间范围，参数：<em>reboot</em>（重启时），<em>annually</em>（每年），<em>monthly</em>（每月），<em>weekly</em>（每周），<em>daily</em>（每天），<em>hourly</em>（每小时）</li><li><strong>state</strong>：指定状态，<em>present</em> 表示添加定时任务，默认设置，<em>absent</em> 表示删除定时任务</li><li><strong>user</strong>：以哪个用户的身份执行</li></ul><h3 id="_1-添加计划任务" tabindex="-1"><a class="header-anchor" href="#_1-添加计划任务"><span>① 添加计划任务</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m cron -a &#39;name=&quot;ntp 每 5 分钟更新一次&quot; minute=*/5 job=&quot;/sbin/ntpdate 172.17.0.1 &amp;&gt; /dev/null&quot;&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;envs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">&quot;jobs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;ntp 每 5 分钟更新一次&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看计划任务列表</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;crontab -l&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token comment">#Ansible: ntp 每 5 分钟更新一次</span>
*/5 * * * * /sbin/ntpdate <span class="token number">172.17</span>.0.1 <span class="token operator">&amp;&gt;</span> /dev/null


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /sbin/ntpdate&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">110160</span> <span class="token number">6</span>月  <span class="token number">23</span> <span class="token number">2020</span> /sbin/ntpdate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-删除计划任务" tabindex="-1"><a class="header-anchor" href="#_2-删除计划任务"><span>② 删除计划任务</span></a></h3><p>查看计划任务列表</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;crontab -l&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token comment">#Ansible: ntp 每 5 分钟更新一次</span>
*/5 * * * * /sbin/ntpdate <span class="token number">172.17</span>.0.1 <span class="token operator">&amp;&gt;</span> /dev/null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m cron -a &#39;name=&quot;df everyday&quot; hour=15 job=&quot;df -lh &gt;&gt; /tmp/disk_total &amp;&gt; /dev/null&quot; state=absent&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;envs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">&quot;jobs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;ntp 每 5 分钟更新一次&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除完成后，我们再查看一下现有的计划任务确认一下：</p><div class="language-perl line-numbers-mode" data-ext="perl" data-title="perl"><pre class="language-perl"><code>
<span class="token punctuation">[</span>root<span class="token variable">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;crontab -l&#39;</span>
<span class="token v-string string">192.168.0.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">|</span> rc<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token comment">#Ansible: ntp 每 5 分钟更新一次</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">/</span>sbin<span class="token operator">/</span>ntpdate <span class="token v-string string">172.17.0.1</span> <span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token regex">/dev/null</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="yum-模块-用于软件的安装" tabindex="-1"><a class="header-anchor" href="#yum-模块-用于软件的安装"><span>yum 模块（用于软件的安装）</span></a></h2><p>顾名思义，该模块主要用于软件的安装。</p><p>其选项如下：</p><ul><li><strong>name</strong>：所安装的包的名称</li><li><strong>state</strong>：<code>present</code> 安装，<code>latest</code> 安装最新的，<code>absent</code> 卸载软件。</li><li><strong>update_cache</strong>：强制更新yum的缓存。</li><li><strong>conf_file</strong>：指定远程yum安装时所依赖的配置文件（安装本地已有的包）。</li><li><strong>disable_pgp_check</strong>：是否禁止GPG checking，只用于<code>present</code>or <code>latest</code>。</li><li><strong>disablerepo</strong>：临时禁止使用yum库。 只用于安装或更新时。</li><li><strong>enablerepo</strong>：临时使用的yum库。只用于安装或更新时。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment">#  ansible web -m yum -a &#39;name=htop state=present&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;changes&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;installed&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;htop&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;msg&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
    <span class="token string">&quot;rc&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;results&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;Loaded plugins: fastestmirror, langpacks<span class="token entity" title="\\n">\\n</span>Loading mirror speeds from cached hostfile<span class="token entity" title="\\n">\\n</span> * base: ftp.sjtu.edu.cn<span class="token entity" title="\\n">\\n</span> * epel: ftp.riken.jp<span class="token entity" title="\\n">\\n</span> * extras: mirror.lzu.edu.cn<span class="token entity" title="\\n">\\n</span> * updates: ftp.sjtu.edu.cn<span class="token entity" title="\\n">\\n</span>Resolving Dependencies<span class="token entity" title="\\n">\\n</span>--&gt; Running transaction check<span class="token entity" title="\\n">\\n</span>---&gt; Package htop.x86_64 0:2.2.0-3.el7 will be installed<span class="token entity" title="\\n">\\n</span>--&gt; Finished Dependency Resolution<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Dependencies Resolved<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>================================================================================<span class="token entity" title="\\n">\\n</span> Package         Arch              Version                Repository       Size<span class="token entity" title="\\n">\\n</span>================================================================================<span class="token entity" title="\\n">\\n</span>Installing:<span class="token entity" title="\\n">\\n</span> htop            x86_64            2.2.0-3.el7            epel            103 k<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Transaction Summary<span class="token entity" title="\\n">\\n</span>================================================================================<span class="token entity" title="\\n">\\n</span>Install  1 Package<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Total download size: 103 k<span class="token entity" title="\\n">\\n</span>Installed size: 218 k<span class="token entity" title="\\n">\\n</span>Downloading packages:<span class="token entity" title="\\n">\\n</span>Running transaction check<span class="token entity" title="\\n">\\n</span>Running transaction test<span class="token entity" title="\\n">\\n</span>Transaction test succeeded<span class="token entity" title="\\n">\\n</span>Running transaction<span class="token entity" title="\\n">\\n</span>  Installing : htop-2.2.0-3.el7.x86_64                                      1/1 <span class="token entity" title="\\n">\\n</span>  Verifying  : htop-2.2.0-3.el7.x86_64                                      1/1 <span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Installed:<span class="token entity" title="\\n">\\n</span>  htop.x86_64 0:2.2.0-3.el7                                                     <span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Complete!<span class="token entity" title="\\n">\\n</span>&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="service-模块-服务程序的管理" tabindex="-1"><a class="header-anchor" href="#service-模块-服务程序的管理"><span>service 模块（服务程序的管理）</span></a></h2><p>该模块用于服务程序的管理。</p><p>其主要选项如下：</p><ul><li><strong>arguments</strong>：命令行提供额外的参数。</li><li><strong>enabled</strong>：设置开机启动。</li><li><strong>name</strong>：服务名称。</li><li><strong>runlevel</strong>：开机启动的级别，一般不用指定。</li><li><strong>sleep</strong>：在重启服务的过程中，是否等待。如在服务关闭以后等待2秒再启动。(定义在剧本中)</li><li><strong>state</strong>：有四种状态，分别为：<code>started</code> 启动服务，<code>stopped</code> 停止服务，<code>restarted</code> 重启服务，<code>reloaded</code> 重载配置。</li></ul><h3 id="_1-开启服务并设置自启动" tabindex="-1"><a class="header-anchor" href="#_1-开启服务并设置自启动"><span>① 开启服务并设置自启动</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m service -a &#39;name=nginx state=started enabled=true&#39; </span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;enabled&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;started&quot;</span>, 
    ……
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>端口是否打开：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ss -ntl&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:80                       *:*                                 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出我们的80端口已经打开。</p><h3 id="_2-关闭服务" tabindex="-1"><a class="header-anchor" href="#_2-关闭服务"><span>② 关闭服务</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m service -a &#39;name=nginx state=stopped&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;stopped&quot;</span>, 
 ……
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>来查看一下端口：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ss -ntl | grep 80&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">&gt;&gt;</span>
non-zero <span class="token builtin class-name">return</span> code
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="user-模块-管理用户账号" tabindex="-1"><a class="header-anchor" href="#user-模块-管理用户账号"><span>user 模块（管理用户账号）</span></a></h2><p>该模块主要是用来管理用户账号。</p><p>其主要选项如下：</p><ul><li><strong>comment</strong>：用户的描述信息。</li><li><strong>createhome</strong>：是否创建家目录。</li><li><strong>force</strong>：在使用state=absent时, 行为与<code>userdel –force</code>一致。</li><li><strong>group</strong>：指定基本组。</li><li><strong>groups</strong>：指定附加组，如果指定为(groups=)表示删除所有组。</li><li><strong>home</strong>：指定用户家目录。</li><li><strong>move_home</strong>：如果设置为home=时, 试图将用户主目录移动到指定的目录。</li><li><strong>name</strong>：指定用户名。</li><li><strong>non_unique</strong>：该选项允许改变非唯一的用户ID值。</li><li><strong>password</strong>：指定用户密码。</li><li><strong>remove</strong>：在使用state=absent时, 行为是与<code>userdel –remove</code>一致。</li><li><strong>shell</strong>：指定默认shell。</li><li><strong>state</strong>：设置帐号状态，不指定为创建，指定值为absent表示删除。</li><li><strong>system</strong>：当创建一个用户，设置这个用户是系统用户。这个设置不能更改现有用户。</li><li><strong>uid</strong>：指定用户的uid。</li></ul><h3 id="_1-添加一个用户并指定其-uid" tabindex="-1"><a class="header-anchor" href="#_1-添加一个用户并指定其-uid"><span>① 添加一个用户并指定其 uid</span></a></h3><div class="language-smalltalk line-numbers-mode" data-ext="smalltalk" data-title="smalltalk"><pre class="language-smalltalk"><code><span class="token punctuation">[</span>root<span class="token operator">@</span>admin ~<span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m user <span class="token operator">-</span>a <span class="token string">&#39;name=a2 uid=11111&#39;</span>
<span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">0.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span><span class="token operator">,</span>
    <span class="token comment">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token operator">,</span>
    <span class="token comment">&quot;comment&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;create_home&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token operator">,</span>
    <span class="token comment">&quot;group&quot;</span><span class="token punctuation">:</span> <span class="token number">11111</span><span class="token operator">,</span>
    <span class="token comment">&quot;home&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;/home/a2&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;a2&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;shell&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;/bin/bash&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;state&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;present&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;system&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token operator">,</span>
    <span class="token comment">&quot;uid&quot;</span><span class="token punctuation">:</span> <span class="token number">11111</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加完成，我们可以去查看一下：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/passwd |grep a2&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
a2:x:11111:11111::/home/a2:/bin/bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-删除用户" tabindex="-1"><a class="header-anchor" href="#_2-删除用户"><span>② 删除用户</span></a></h3><div class="language-dart line-numbers-mode" data-ext="dart" data-title="dart"><pre class="language-dart"><code><span class="token punctuation">[</span>root<span class="token metadata function">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m user <span class="token operator">-</span>a <span class="token string-literal"><span class="token string">&#39;name=a2 state=absent&#39;</span></span>
<span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string-literal"><span class="token string">&quot;ansible_facts&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string-literal"><span class="token string">&quot;discovered_interpreter_python&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;/usr/bin/python&quot;</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;changed&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;force&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;name&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;a2&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;remove&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;state&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;absent&quot;</span></span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一样的，删除之后，我们去看一下：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/passwd |grep a2&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">&gt;&gt;</span>
non-zero <span class="token builtin class-name">return</span> code
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发现已经没有这个用户了。</p><h2 id="group-模块-添加或删除组" tabindex="-1"><a class="header-anchor" href="#group-模块-添加或删除组"><span>group 模块（添加或删除组）</span></a></h2><p>该模块主要用于添加或删除组。</p><p>常用的选项如下：</p><ul><li><strong>gid</strong>：设置组的GID号。</li><li><strong>name</strong>：指定组的名称。</li><li><strong>state</strong>：指定组的状态，默认为创建，设置值为<code>absent</code>为删除。</li><li><strong>system</strong>：设置值为<code>yes</code>，表示创建为系统组。</li></ul><h3 id="_1-创建组" tabindex="-1"><a class="header-anchor" href="#_1-创建组"><span>① 创建组</span></a></h3><div class="language-dart line-numbers-mode" data-ext="dart" data-title="dart"><pre class="language-dart"><code><span class="token punctuation">[</span>root<span class="token metadata function">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m group <span class="token operator">-</span>a <span class="token string-literal"><span class="token string">&#39;name=a2 gid=12222&#39;</span></span>
<span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string-literal"><span class="token string">&quot;ansible_facts&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string-literal"><span class="token string">&quot;discovered_interpreter_python&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;/usr/bin/python&quot;</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;changed&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;gid&quot;</span></span><span class="token punctuation">:</span> <span class="token number">12222</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;name&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;dd&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;state&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;present&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;system&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建过后，我们来查看一下：</p><div class="language-makefile line-numbers-mode" data-ext="makefile" data-title="makefile"><pre class="language-makefile"><code>[root<span class="token operator">@</span>admin ~]<span class="token comment"># ansible web -m shell -a &#39;cat /etc/group | grep 12222&#39;</span>
192.168.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> rc<span class="token operator">=</span>0 &gt;&gt;
<span class="token target symbol">a2</span><span class="token punctuation">:</span>x<span class="token punctuation">:</span>12222<span class="token punctuation">:</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出，我们的组已经创建成功了。</p><h3 id="_2-删除组" tabindex="-1"><a class="header-anchor" href="#_2-删除组"><span>② 删除组</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m group -a &#39;name=a2 state=absent&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;a2&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;absent&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>照例查看一下：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/group | grep 12222&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">&gt;&gt;</span>
non-zero <span class="token builtin class-name">return</span> code

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>已经没有这个组的相关信息了。</p><h2 id="script-模块-将本机的脚本sh在被管理端的机器上运行" tabindex="-1"><a class="header-anchor" href="#script-模块-将本机的脚本sh在被管理端的机器上运行"><span>script 模块（将本机的脚本sh在被管理端的机器上运行）</span></a></h2><p>该模块用于将本机的脚本在被管理端的机器上运行。</p><p>该模块直接指定脚本的路径即可，我们通过例子来看一看到底如何使用的：</p><p>首先，我们写一个脚本，并给其加上执行权限：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># vim /root/df.sh</span>

<span class="token comment">#!/bin/bash</span>

<span class="token function">date</span> <span class="token operator">&gt;&gt;</span> /root/disk_total.log
<span class="token function">df</span> <span class="token parameter variable">-lh</span> <span class="token operator">&gt;&gt;</span> /root/disk_total.log
 
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># chmod +x /root/df.sh </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，我们直接运行命令来实现在被管理端执行该脚本：</p><div class="language-swift line-numbers-mode" data-ext="swift" data-title="swift"><pre class="language-swift"><code><span class="token punctuation">[</span>root<span class="token attribute atrule">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m script <span class="token operator">-</span>a &#39;<span class="token operator">/</span>root<span class="token operator">/</span>df<span class="token punctuation">.</span>sh&#39;
<span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">0.8</span> <span class="token operator">|</span> <span class="token constant">CHANGED</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token string-literal"><span class="token string">&quot;changed&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;rc&quot;</span></span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stderr&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Shared connection to 192.168.0.8 closed.\\r\\n&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stderr_lines&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string-literal"><span class="token string">&quot;Shared connection to 192.168.0.8 closed.&quot;</span></span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stdout&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stdout_lines&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>照例查看一下文件内容：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /root/disk_total.log&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token number">2022</span>年 07月 <span class="token number">28</span>日 星期四 <span class="token number">15</span>:23:35 CST
文件系统                 容量  已用  可用 已用% 挂载点
devtmpfs                 <span class="token number">3</span>.8G     <span class="token number">0</span>  <span class="token number">3</span>.8G    <span class="token number">0</span>% /dev
tmpfs                    <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G    <span class="token number">0</span>% /dev/shm
tmpfs                    <span class="token number">3</span>.9G   12M  <span class="token number">3</span>.8G    <span class="token number">1</span>% /run
tmpfs                    <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G    <span class="token number">0</span>% /sys/fs/cgroup
/dev/mapper/centos-root   50G  <span class="token number">2</span>.9G   48G    <span class="token number">6</span>% /
/dev/sda1               1014M  199M  816M   <span class="token number">20</span>% /boot
/dev/mapper/centos-home  142G   33M  142G    <span class="token number">1</span>% /home
tmpfs 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出已经执行成功了。</p><h2 id="setup-模块-收集被管理主机的信息" tabindex="-1"><a class="header-anchor" href="#setup-模块-收集被管理主机的信息"><span>setup 模块（收集被管理主机的信息）</span></a></h2><p>该模块主要用于收集信息，是通过调用facts组件来实现的。</p><p>facts 组件是Ansible用于采集被管机器设备信息的一个功能，我们可以使用setup模块查机器的所有facts信息，可以使用filter来查看指定信息。整个facts信息被包装在一个JSON格式的数据结构中，ansible_facts是最上层的值。</p><p>facts 就是变量，内建变量。每个主机的各种信息，cpu颗数、内存大小等。会存在facts中的某个变量中。调用后返回很多对应主机的信息，在后面的操作中可以根据不同的信息来做不同的操作。如redhat系列用yum安装，而debian系列用apt来安装软件。</p><h3 id="_1-查看信息" tabindex="-1"><a class="header-anchor" href="#_1-查看信息"><span>① 查看信息</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m setup -a &#39;filter=&quot;*mem*&quot;&#39;</span>
192.168.0.8 <span class="token punctuation">|</span> SUCCESS =<span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token key atrule">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;ansible_memfree_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7068</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memory_mb&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">&quot;nocache&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7456</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">346</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;real&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7068</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">734</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;swap&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;cached&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memtotal_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以通过命令查看一下内存的大小以确认一下是否一致：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;free -m&#39;</span>


192.168.0.8 <span class="token punctuation">|</span> CHANGED <span class="token punctuation">|</span> rc=0 <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span>
              total        used        free      shared  buff/cache   available
<span class="token key atrule">Mem</span><span class="token punctuation">:</span>           7802         309        7067          11         426        7247
<span class="token key atrule">Swap</span><span class="token punctuation">:</span>          8063           0        8063

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出信息是一致的。</p><h3 id="_2-保存信息" tabindex="-1"><a class="header-anchor" href="#_2-保存信息"><span>② 保存信息</span></a></h3><p>我们的setup模块还有一个很好用的功能就是可以保存我们所筛选的信息至我们的主机上，同时，文件名为我们被管制的主机的IP，这样方便我们知道是哪台机器出的问题。</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m setup -a &#39;filter=&quot;*mem*&quot;&#39; --tree /root/facts</span>
192.168.0.8 <span class="token punctuation">|</span> SUCCESS =<span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token key atrule">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;ansible_memfree_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memory_mb&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">&quot;nocache&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7454</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">348</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;real&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">738</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;swap&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;cached&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memtotal_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后我们可以去查看一下：</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># cd /root/facts/</span>
<span class="token punctuation">[</span>root@admin facts<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@admin facts<span class="token punctuation">]</span><span class="token comment"># cat 192.168.0.8</span>
<span class="token punctuation">{</span><span class="token key atrule">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;ansible_memfree_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;ansible_memory_mb&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;nocache&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7454</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">348</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;real&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">738</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;swap&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;cached&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;ansible_memtotal_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,138);function q(h,f){const a=p("ExternalLinkIcon");return l(),i("div",null,[r,d,s("p",null,[s("a",k,[n("ansible 中文指南"),e(a)])]),s("p",null,[s("a",m,[n("本节示例文件 提取码：1234"),e(a)])]),b,s("p",null,[n("参考："),s("a",v,[n("https://blog.csdn.net/qq_42476834/article/details/124766896"),e(a)])]),g])}const x=o(u,[["render",q],["__file","ansible.html.vue"]]),w=JSON.parse('{"path":"/linux/ansible/ansible.html","title":"Ansible AD-Hoc命令执行工具","lang":"zh-CN","frontmatter":{"icon":"linux","title":"Ansible AD-Hoc命令执行工具","category":["Linux"],"headerDepth":5,"date":"2022-07-29T00:00:00.000Z","order":1,"tag":["Ansible"],"description":"Ansible AD-Hoc命令执行工具","head":[["meta",{"property":"og:url","content":"https://blogres.github.io/linux/ansible/ansible.html"}],["meta",{"property":"og:title","content":"Ansible AD-Hoc命令执行工具"}],["meta",{"property":"og:description","content":"Ansible AD-Hoc命令执行工具"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-18T02:10:21.000Z"}],["meta",{"property":"article:author","content":"blogres"}],["meta",{"property":"article:tag","content":"Ansible"}],["meta",{"property":"article:published_time","content":"2022-07-29T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-18T02:10:21.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Ansible AD-Hoc命令执行工具\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-07-29T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-18T02:10:21.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"blogres\\",\\"url\\":\\"/article\\"}]}"]]},"headers":[{"level":2,"title":"简介","slug":"简介","link":"#简介","children":[]},{"level":2,"title":"自己配置","slug":"自己配置","link":"#自己配置","children":[]},{"level":2,"title":"SSH免密登录","slug":"ssh免密登录","link":"#ssh免密登录","children":[]},{"level":2,"title":"主机连通性测试","slug":"主机连通性测试","link":"#主机连通性测试","children":[]},{"level":2,"title":"command 模块（直接在远程主机上执行命令，并将结果返回本主机）","slug":"command-模块-直接在远程主机上执行命令-并将结果返回本主机","link":"#command-模块-直接在远程主机上执行命令-并将结果返回本主机","children":[{"level":3,"title":"chdir在执行命令之前，先切换到该目录","slug":"chdir在执行命令之前-先切换到该目录","link":"#chdir在执行命令之前-先切换到该目录","children":[]},{"level":3,"title":"creates（存在，不执行ls，不存在，执行ls）","slug":"creates-存在-不执行ls-不存在-执行ls","link":"#creates-存在-不执行ls-不存在-执行ls","children":[]},{"level":3,"title":"removes（存在，执行ls、不存在，不执行ls）","slug":"removes-存在-执行ls、不存在-不执行ls","link":"#removes-存在-执行ls、不存在-不执行ls","children":[]}]},{"level":2,"title":"Shell 模块","slug":"shell-模块","link":"#shell-模块","children":[]},{"level":2,"title":"copy 模块","slug":"copy-模块","link":"#copy-模块","children":[{"level":3,"title":"复制文件（src、dest）","slug":"复制文件-src、dest","link":"#复制文件-src、dest","children":[]},{"level":3,"title":"给定内容生成文件（content），并制定权限（mode）","slug":"给定内容生成文件-content-并制定权限-mode","link":"#给定内容生成文件-content-并制定权限-mode","children":[]},{"level":3,"title":"覆盖备份（backup）","slug":"覆盖备份-backup","link":"#覆盖备份-backup","children":[]}]},{"level":2,"title":"file 模块（文件管理）","slug":"file-模块-文件管理","link":"#file-模块-文件管理","children":[{"level":3,"title":"创建目录","slug":"创建目录","link":"#创建目录","children":[]},{"level":3,"title":"创建链接文件","slug":"创建链接文件","link":"#创建链接文件","children":[]},{"level":3,"title":"删除文件","slug":"删除文件","link":"#删除文件","children":[]}]},{"level":2,"title":"fetch 模块（复制远程文件到本地主机）","slug":"fetch-模块-复制远程文件到本地主机","link":"#fetch-模块-复制远程文件到本地主机","children":[]},{"level":2,"title":"cron 模块（计划任务）","slug":"cron-模块-计划任务","link":"#cron-模块-计划任务","children":[{"level":3,"title":"① 添加计划任务","slug":"_1-添加计划任务","link":"#_1-添加计划任务","children":[]},{"level":3,"title":"② 删除计划任务","slug":"_2-删除计划任务","link":"#_2-删除计划任务","children":[]}]},{"level":2,"title":"yum 模块（用于软件的安装）","slug":"yum-模块-用于软件的安装","link":"#yum-模块-用于软件的安装","children":[]},{"level":2,"title":"service 模块（服务程序的管理）","slug":"service-模块-服务程序的管理","link":"#service-模块-服务程序的管理","children":[{"level":3,"title":"① 开启服务并设置自启动","slug":"_1-开启服务并设置自启动","link":"#_1-开启服务并设置自启动","children":[]},{"level":3,"title":"② 关闭服务","slug":"_2-关闭服务","link":"#_2-关闭服务","children":[]}]},{"level":2,"title":"user 模块（管理用户账号）","slug":"user-模块-管理用户账号","link":"#user-模块-管理用户账号","children":[{"level":3,"title":"① 添加一个用户并指定其 uid","slug":"_1-添加一个用户并指定其-uid","link":"#_1-添加一个用户并指定其-uid","children":[]},{"level":3,"title":"② 删除用户","slug":"_2-删除用户","link":"#_2-删除用户","children":[]}]},{"level":2,"title":"group 模块（添加或删除组）","slug":"group-模块-添加或删除组","link":"#group-模块-添加或删除组","children":[{"level":3,"title":"① 创建组","slug":"_1-创建组","link":"#_1-创建组","children":[]},{"level":3,"title":"② 删除组","slug":"_2-删除组","link":"#_2-删除组","children":[]}]},{"level":2,"title":"script 模块（将本机的脚本sh在被管理端的机器上运行）","slug":"script-模块-将本机的脚本sh在被管理端的机器上运行","link":"#script-模块-将本机的脚本sh在被管理端的机器上运行","children":[]},{"level":2,"title":"setup 模块（收集被管理主机的信息）","slug":"setup-模块-收集被管理主机的信息","link":"#setup-模块-收集被管理主机的信息","children":[{"level":3,"title":"① 查看信息","slug":"_1-查看信息","link":"#_1-查看信息","children":[]},{"level":3,"title":"② 保存信息","slug":"_2-保存信息","link":"#_2-保存信息","children":[]}]}],"git":{"createdTime":1706536810000,"updatedTime":1713406221000,"contributors":[{"name":"topjfy","email":"topjfk@163.com","commits":5}]},"readingTime":{"minutes":17.32,"words":5196},"filePathRelative":"linux/ansible/ansible.md","localizedDate":"2022年7月29日","excerpt":"<p>Ansible AD-Hoc命令执行工具</p>\\n","autoDesc":true}');export{x as comp,w as data};
